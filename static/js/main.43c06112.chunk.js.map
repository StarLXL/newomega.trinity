{"version":3,"sources":["definitions/Ships.js","common/OmegaLoadingScreen.js","scenes/ShipSelection.js","definitions/Commanders.js","scenes/CommanderSelection.js","scenes/Combat.js","ui/OpponentSelection.js","ui/Leaderboard.js","ui/ShowLogs.js","definitions/GameEngine.js","OmegaApp.js","index.tsx"],"names":["Ships","name","asset","description","stats","cp","hp","attack","base","variable","defence","speed","range","agility","scale","combatScale","visuals","beamColor","Color3","beamWidth","Math","PI","OmegaLoadingScreen","window","document","getElementById","style","display","ShipSelection","props","useState","currentShip","setCurrentShip","_","map","selectedShips","setSelectedShips","currentCp","setCurrentCp","scene","setScene","loadedMeshes","setLoadedMeshes","resourcesLoaded","setResourcesLoaded","notEnoughShips","setNotEnoughShips","getCurrentCP","reduce","memo","num","index","onDone","loadResources","Promise","resolve","reject","assetsManager","AssetsManager","each","ship","addMeshTask","onSuccess","task","newMeshes","shipIndex","position","Vector3","Zero","rotation","scalingDeterminant","isVisible","onFinish","tasks","load","loadCurrentShip","loadedMeshesOverride","meshes","mesh","shipAdderClassName","className","antialias","adaptToDeviceRatio","canvasId","onSceneMount","e","canvas","getEngine","loadingScreen","camera","ArcRotateCamera","minZ","lowerRadiusLimit","upperRadiusLimit","activeCameras","push","attachControl","HemisphericLight","Up","intensity","background","Layer","isBackground","texture","level","wAng","then","onBeforeRenderObservable","add","deltaTimeInMillis","getDeltaTime","y","z","accuracy","onClick","cost","maxCp","newShip","newShipSafe","length","href","CommanderRarities","CommanderRaritiesColors","0","1","2","3","Commanders","modifier","vs","pickAnimations","positionOffset","rarity","CommanderSelection","currentCommander","setCurrentCommander","commander","commanderIndex","loadCurrentCommander","invoke","filter","animationGroups","group","contains","commanderRarityColor","commanderRarityString","commanderAttackSuffix","has","commanderAttackString","commanderDefenceSuffix","commanderDefenceString","upperAlphaLimit","lowerAlphaLimit","upperBetaLimit","lowerBetaLimit","color","newCommander","newCommanderSafe","Combat","round","setRound","showingResult","setShowingResult","combatLog","setCombatLog","shipMeshesLhs","shipMeshesRhs","afterImportMeshes","basePosition","count","direction","isLhs","newMesh","material","StandardMaterial","uniqueId","diffuseColor","i","clonedMesh","clone","floor","localLog","showAttacks","move","sourceMeshes","targetMeshes","source","sourceMesh","ind","target","targetMeshIndex","targetMesh","mat","alpha","backFaceCulling","lines","Mesh","CreateTube","FRONTSIDE","convertToFlatShadedMesh","setTimeout","dispose","showLaser","playMoves","moves","shipHpsLhs","shipHpsRhs","_recursiveMover","mainResolver","moveType","all","slide","Animation","ANIMATIONTYPE_FLOAT","ANIMATIONLOOPMODE_CONSTANT","keyFrames","frame","value","x","abs","targetPosition","setKeys","animations","beginAnimation","moveShips","damage","hpPerShip","hpsLeft","shipsLeft","max","ceil","shipsToRemove","removeIndex","meshToRemove","shift","ParticleHelper","CreateAsync","set","systems","forEach","s","worldOffset","disposeOnStop","maxSize","minSize","start","applyHpsToVisuals","newEntry","logAttack","playRound","result","rounds","logRoundStart","lhsMoves","lhs","isEmpty","rhsMoves","rhs","commanderAssetLhs","commanderLhs","commanderAssetRhs","commanderRhs","selectionLhs","sceneFile","selectionRhs","playCombat","alt","src","isDead","shipHps","find","shipHp","lhsHp","rhsHp","getWinnerString","OpponentSelection","opponents","opponent","key","selectOpponent","Leaderboard","leaderboard","entry","player","wins","toNumber","losses","ShowLogs","logs","log","selectLog","args","GameEngine","shipPositionsLhs","shipPositionsRhs","shipMaxHpLhs","shipMaxHpRhs","getTarget","shipPositionsOwn","shipPositionsEnemy","shipHpsEnemy","distances","positionTarget","enemyShip","distance","Number","MAX_SAFE_INTEGER","min","indexOf","getTargetLhs","getTargetRhs","calculateDamage","sourceHp","sourceMaxHp","random","capDamage","isPositionFree","positionIter","shipPositions","speedCheck","proposedPosition","moveShipRhs","logShoot","logMove","logLhsShoot","logLhsMove","logRhsShoot","logRhsMove","Modes","OmegaApp","defaultLoadedState","mode","loading","trainingSelfSelection","trainingResult","trainingSelfCommander","trainingOpponent","trainingOpponentSelection","trainingOpponentCommander","trainingCp","defenders","settingDefence","settingAttack","defaultUnloadedState","ownAccount","web3Loaded","gameEngineContract","gameManagerContract","state","selection","this","setState","registerDefence","defenceSelection","_selectionToCp","filters","FightComplete","fromBlock","provider","getBlockNumber","b","toBlock","attacker","getLogs","logsParsed","interface","parseLog","_parseMoves","_parseHp","hpInst","resultJson","getAllDefenders","getLeaderboard","training","bind","commanders","showLogs","defend","shipSelectionDone","commanderSelectionDone","commanderPreviewDone","opponentSelectionDone","logSelectionDone","id","_initWeb3","ethers","providers","Web3Provider","ethereum","signer","getSigner","send","accounts","_loadContracts","gameEngineJson","require","Contract","gameManagerJson","Component","Sentry","dsn","debug","autoSessionTracking","tracesSampleRate","ReactDOM","render"],"mappings":"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","file":"static/js/main.43c06112.chunk.js","sourcesContent":["import { Color3 } from '@babylonjs/core';\n\nexport const Ships = [\n    {\n        name: 'Frigate',\n        asset: 'assets/frigate/',\n        description: 'Cheap, quick and agile, the frigate can be used as a quick strike weapon, able to reach enemy lines quickest. Can not withstand much heat though.',\n        stats: {\n            cp: 1,\n            hp: 1000,\n            attack: {\n                base: 30,\n                variable: 5,\n            },\n            defence: 2,\n            speed: 4,\n            range: 4,\n            agility: 25,\n        },\n        scale: 1,\n        combatScale: 0.6,\n        visuals: {\n            beamColor: new Color3(0, 1, 0),\n            beamWidth: Math.PI / 256,\n        },\n    },\n    {\n        name: 'Cruiser',\n        asset: 'assets/cruiser/',\n        description: 'As lightest of the heavier ships, the cruiser retains some of the speed and maneuverability of the frigate while offering big improvements in the hull and weaponry.',\n        stats: {\n            cp: 4,\n            hp: 4000,\n            attack: {\n                base: 100,\n                variable: 20,\n            },\n            defence: 12,\n            speed: 3,\n            range: 7,\n            agility: 15,\n        },\n        scale: 6,\n        combatScale: 0.4,\n        visuals: {\n            beamColor: new Color3(0.2, 0.2, 1),\n            beamWidth: Math.PI / 96,\n        },\n    },\n    {\n        name: 'Destroyer',\n        asset: 'assets/destroyer/',\n        description: 'The destroyer is an effective killing machine, providing both effective support and serving as an artillery line raining heavy damage on enemy ships.',\n        stats: {\n            cp: 5,\n            hp: 5000,\n            attack: {\n                base: 130,\n                variable: 10,\n            },\n            defence: 15,\n            speed: 2,\n            range: 8,\n            agility: 10,\n        },\n        scale: 9,\n        combatScale: 0.5,\n        visuals: {\n            beamColor: new Color3(1, 1, 1),\n            beamWidth: Math.PI / 96,\n        },\n    },\n    {\n        name: 'Battleship',\n        asset: 'assets/battleship/',\n        description: 'Fitted with state of the art weaponry and protection, the battleship is the ultimate fighting force in the galaxy.',\n        stats: {\n            cp: 15,\n            hp: 10000,\n            attack: {\n                base: 200,\n                variable: 5,\n            },\n            defence: 20,\n            speed: 1,\n            range: 8,\n            agility: 0,\n        },\n        scale: 12,\n        combatScale: 0.6,\n        visuals: {\n            beamColor: new Color3(1, 0, 1),\n            beamWidth: Math.PI / 64,\n        },\n    },\n];\n","export class OmegaLoadingScreen {\n    displayLoadingUI() {\n        const loadingScreenDiv = window.document.getElementById('omegaLoadingScreen');\n        loadingScreenDiv.style.display = 'block';\n    }\n\n    hideLoadingUI() {\n        const loadingScreenDiv = window.document.getElementById('omegaLoadingScreen');\n        loadingScreenDiv.style.display = 'none';\n    }\n}\n","import React, { useState } from 'react';\nimport _ from 'underscore';\nimport { Engine, Scene } from 'react-babylonjs';\nimport { Vector3, AssetsManager, Layer, ArcRotateCamera, HemisphericLight } from '@babylonjs/core';\nimport '@babylonjs/loaders';\nimport { Ships } from '../definitions/Ships';\nimport { OmegaLoadingScreen } from '../common/OmegaLoadingScreen';\nimport './ShipSelection.css';\n\nexport const ShipSelection = (props) => {\n    const [ currentShip, setCurrentShip ] = useState(0);\n    const [ selectedShips, setSelectedShips ] = useState(_.map(Ships, () => { return 0 }));\n    const [ currentCp, setCurrentCp ] = useState(0);\n    const [ scene, setScene ] = useState(null);\n    const [ loadedMeshes, setLoadedMeshes ] = useState([]);\n    const [ resourcesLoaded, setResourcesLoaded ] = useState(false);\n    const [ notEnoughShips, setNotEnoughShips ] = useState(false);\n\n    const nextShip = () => {\n        const newShip = currentShip + 1;\n        const newShipSafe = newShip >= Ships.length ? 0 : newShip;\n        setCurrentShip(newShipSafe);\n        loadCurrentShip(newShipSafe, scene);\n    };\n\n    const prevShip = () => {\n        const newShip = currentShip - 1;\n        const newShipSafe = newShip < 0 ? Ships.length - 1 : newShip;\n        setCurrentShip(newShipSafe);\n        loadCurrentShip(newShipSafe, scene);\n    };\n\n    const getCurrentCP = (selectedShips) => {\n        return _.reduce(selectedShips, (memo, num, index) => {\n            return memo + (num || 0) * Ships[index].stats.cp;\n        }, 0);\n    };\n\n    const addShip = () => {\n        const cost = Ships[currentShip].stats.cp;\n        const currentCp = getCurrentCP(selectedShips);\n        if (currentCp + cost <= props.maxCp) {\n            selectedShips[currentShip] = (selectedShips[currentShip] || 0) + 1;\n            setSelectedShips(selectedShips); // TODO NEEDED?\n            setCurrentCp(getCurrentCP(selectedShips));\n        }\n\n        setNotEnoughShips(false);\n    };\n\n    const removeShip = () => {\n        if (selectedShips[currentShip] > 0) {\n            selectedShips[currentShip]--;\n            setSelectedShips(selectedShips); // TODO NEEDED?\n            setCurrentCp(getCurrentCP(selectedShips));\n        }\n    };\n\n    const onDone = () => {\n        props.onDone(selectedShips);\n    };\n\n    const afterLoadShip = (scene, newMeshes, shipIndex) => {\n        newMeshes[0].position = Vector3.Zero();\n        newMeshes[0].rotation = new Vector3(-Math.PI / 12, Math.PI, 0);\n        newMeshes[0].scalingDeterminant = 0.001 * Ships[shipIndex].scale;\n        newMeshes[0].isVisible = false;\n    };\n\n    const loadResources = (scene) => {\n        return new Promise((resolve, reject) => {\n            const loadedMeshes = [];\n\n            const assetsManager = new AssetsManager(scene);\n            _.each(Ships, (ship, index) => {\n                const task = assetsManager.addMeshTask(index, '',\n                    Ships[index].asset,\n                    'scene.gltf');\n                task.onSuccess = (task) => {\n                    loadedMeshes[index] = task.loadedMeshes;\n                    afterLoadShip(scene, task.loadedMeshes, index);\n                };\n            });\n\n            assetsManager.onFinish = (tasks) => {\n                setLoadedMeshes(loadedMeshes);\n                resolve(loadedMeshes);\n            };\n\n            assetsManager.load();\n        });\n    };\n\n    const loadCurrentShip = (currentShip, scene, loadedMeshesOverride) => {\n        const meshes = loadedMeshesOverride || loadedMeshes;\n\n        _.each(scene.meshes, (mesh) => {\n            mesh.isVisible = false;\n        });\n\n        _.each(meshes[currentShip], (mesh) => {\n            mesh.isVisible = true;\n        });\n    };\n\n    const onSceneMount = (e) => {\n        const { canvas, scene } = e;\n        setScene(scene);\n\n        scene.getEngine().loadingScreen = new OmegaLoadingScreen();\n\n        const camera = new ArcRotateCamera('camera1',\n            Math.PI / 2, Math.PI / 2, 9.0, Vector3.Zero(), scene);\n        camera.minZ = 0.001;\n        camera.lowerRadiusLimit = 9.0;\n        camera.upperRadiusLimit = 9.0;\n        scene.activeCameras.push(camera);\n        camera.attachControl(canvas, true);\n\n        const light = new HemisphericLight('light1', Vector3.Up(), scene);\n        light.intensity = 0.7;\n\n        const background = new Layer('background',\n            '/assets/images/jeremy-perkins-uhjiu8FjnsQ-unsplash.jpg', scene);\n        background.isBackground = true;\n        background.texture.level = 0;\n        background.texture.wAng = .2;\n\n        loadResources(scene).then((loadedMeshes) => {\n            setResourcesLoaded(true);\n            loadCurrentShip(currentShip, scene, loadedMeshes);\n        });\n\n        scene.onBeforeRenderObservable.add(() => {\n            const deltaTimeInMillis = scene.getEngine().getDeltaTime();\n\n            _.each(scene.meshes, (mesh) => {\n                const rpm = 2;\n                mesh.rotation.y +=\n                    ((rpm / 60) * Math.PI * 2 * (deltaTimeInMillis / 1000));\n                mesh.rotation.z +=\n                    ((rpm / 60) * Math.PI * 2 * (deltaTimeInMillis / 1000));\n            });\n        });\n    };\n\n    const checkEnoughShipsAndDone = () => {\n        const notEnoughShips = currentCp < props.maxCp;\n        setNotEnoughShips(notEnoughShips);\n        if (!notEnoughShips) {\n            onDone();\n        }\n    };\n\n    const shipAdderClassName = `addOrRemoveShip addShip ${notEnoughShips ? 'highlightOverModal' : ''}`;\n\n    return (\n        <div className=\"ShipSelection\">\n            <Engine antialias={true} adaptToDeviceRatio={true} canvasId=\"ship-selection\">\n                <Scene onSceneMount={onSceneMount}/>\n            </Engine>\n            {resourcesLoaded &&\n                <div className=\"ui\">\n                    <div className=\"uiElement shipName\">\n                        {Ships[currentShip].name}\n                    </div>\n                    <div className=\"uiElement sideBox shipStats\">\n                        <div>\n                            HP: {Ships[currentShip].stats.hp}\n                        </div>\n                        <div>\n                            Attack: {Ships[currentShip].stats.attack.base} - {Ships[currentShip].stats.attack.base + Ships[currentShip].stats.attack.variable}\n                        </div>\n                        <div>\n                            Defence: {Ships[currentShip].stats.defence}\n                        </div>\n                        <div>\n                            Speed: {Ships[currentShip].stats.speed}\n                        </div>\n                        <div>\n                            Range: {Ships[currentShip].stats.range}\n                        </div>\n                        <div>\n                            Accuracy: {Ships[currentShip].stats.accuracy}\n                        </div>\n                        <div>\n                            Agility: {Ships[currentShip].stats.agility}\n                        </div>\n                    </div>\n                    <div className=\"uiElement sideBox shipControls\">\n                        <div className={shipAdderClassName} onClick={addShip}>\n                            +\n                        </div>\n                        <div>\n                            Max CP: <span className=\"maxCp\">{props.maxCp}</span>\n                        </div>\n                        <div>\n                            CP Cost: {Ships[currentShip].stats.cp}\n                        </div>\n                        <div>\n                            Used ships: {selectedShips[currentShip] || 0}\n                        </div>\n                        <div>\n                            Used CP: {currentCp}\n                        </div>\n                        <div className=\"addOrRemoveShip removeShip\" onClick={removeShip}>\n                            -\n                        </div>\n                    </div>\n                    <div className=\"uiElement shipDescription\">\n                        {Ships[currentShip].description}\n                    </div>\n                    <div className=\"uiElement chevron left\" onClick={prevShip}/>\n                    <div className=\"uiElement chevron right\" onClick={nextShip}/>\n                    <div className=\"uiElement doneBox\" onClick={checkEnoughShipsAndDone}>\n                        DONE\n                    </div>\n                    <a className=\"miniLogoBox\" href=\"/\">\n                    </a>\n                    <div className=\"omegaTip\">\n                        <div className=\"title\">\n                            Ship Selection\n                        </div>\n                        <div className=\"explanation\">\n                            <div className=\"tip\">\n                                1. The amount of ships in a fight is determined by the Command Power (CP) of the Defender fleet.\n                            </div>\n                            <div className=\"tip\">\n                                2. Each ship costs a certain amount of CP.\n                            </div>\n                            <div className=\"tip\">\n                                3. The Attacker selects a fleet, the total CP of which can not exceed the total CP of the Defender.\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            }\n            {notEnoughShips &&\n                <div className=\"modal\">\n                    <div className=\"modal-popup\">\n                        <div className=\"modal-body\">\n                            <div className=\"modal-title\">You can still add ships to your fleet, Admiral!</div>\n                            <div>Tip: Add ships to your fleet with the + button to the right of ship portrait.</div>\n                        </div>\n                        <div className=\"modal-buttons\">\n                            <div className=\"modal-button left\" onClick={() => { setNotEnoughShips(false); }}>\n                                Back\n                            </div>\n                            <div className=\"modal-button right\" onClick={() => {\n                                setNotEnoughShips(false);\n                                onDone();\n                            }}>\n                                Start Anyway\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            }\n        </div>\n    );\n}\n","import { Vector3 } from '@babylonjs/core';\n\nexport const CommanderRarities = {\n    Common: 0,\n    Rare: 1,\n    Epic: 2,\n    Legendary: 3,\n};\n\nexport const CommanderRaritiesColors = {\n    0: '#73ffbe',\n    1: '#2196F3',\n    2: '#7B1FA2',\n    3: '#FFD740',\n};\n\nexport const commanderRarityToString = (rarity) => {\n    const lookup = {\n        0: 'Common',\n        1: 'Rare',\n        2: 'Epic',\n        3: 'Legendary'\n    };\n\n    return lookup[rarity] || '';\n};\n\nexport const Commanders = [\n    {\n        name: 'XT-101',\n        asset: 'assets/robot_5/',\n        description: 'Standard issue command robot issued to all Commanders. First and last iteration of its kind, provides slight bonuses to attack and defence.',\n        stats: {\n            attack: {\n                modifier: 2,\n                vs: 0,\n            },\n            defence: {\n                modifier: 2,\n                vs: 0,\n            },\n        },\n        scale: 10,\n        visuals: {\n            pickAnimations: ['Ball_To_Stand', 'Idle', 'Idle_Look_Back', 'Idle_Look_Side'],\n            positionOffset: new Vector3(0, 0.8, 0),\n        },\n        rarity: CommanderRarities.Common,\n    },\n    {\n        name: 'YT-106',\n        asset: 'assets/worker_12/',\n        description: 'Military grade command robot, in its sixth iteration. Smarter and more effective than the XT, is also known to be moody and disingenuous.',\n        stats: {\n            attack: {\n                modifier: 3,\n                vs: 1,\n            },\n            defence: {\n                modifier: 3,\n                vs: 1,\n            },\n        },\n        scale: 300,\n        visuals: {\n\n        },\n        rarity: CommanderRarities.Rare,\n    },\n    {\n        name: 'HV-12',\n        asset: 'assets/mech_walker/',\n        description: 'Since the entire series is classified, not much is known about the origins of this killing machine. It is clearly an assasination model.',\n        stats: {\n            attack: {\n                modifier: 4,\n            },\n            defence: {\n                modifier: 3,\n            },\n        },\n        scale: 300,\n        visuals: {\n            positionOffset: new Vector3(0, -1.2, 0),\n            rotation: new Vector3(0, 0, 0),\n        },\n        rarity: CommanderRarities.Epic,\n    },\n    {\n        name: 'Magnus',\n        asset: 'assets/trooper/',\n        description: 'Cyborgs are the ultimate combination of human intuition and robot processing power. While lacking in empathy, they make for formiddable commanders.',\n        stats: {\n            attack: {\n                modifier: 10,\n            },\n            defence: {\n                modifier: 5,\n            },\n        },\n        scale: 60,\n        visuals: {\n            positionOffset: new Vector3(0, -1.8, 0),\n        },\n        rarity: CommanderRarities.Legendary,\n    },\n];\n","import React, { useState } from 'react';\nimport _ from 'underscore';\nimport { Engine, Scene } from 'react-babylonjs';\nimport { Vector3, AssetsManager, Layer, ArcRotateCamera, HemisphericLight } from '@babylonjs/core';\nimport '@babylonjs/loaders';\nimport { Commanders, CommanderRaritiesColors, commanderRarityToString } from '../definitions/Commanders';\nimport { Ships } from '../definitions/Ships';\nimport { OmegaLoadingScreen } from '../common/OmegaLoadingScreen';\nimport './CommanderSelection.css';\n\nexport const CommanderSelection = (props) => {\n    const [ currentCommander, setCurrentCommander ] = useState(0);\n    const [ scene, setScene ] = useState(null);\n    const [ loadedMeshes, setLoadedMeshes ] = useState([]);\n    const [ resourcesLoaded, setResourcesLoaded ] = useState(false);\n\n    const nextCommander = () => {\n        const newCommander = currentCommander + 1;\n        const newCommanderSafe = newCommander >= Commanders.length ? 0 : newCommander;\n        setCurrentCommander(newCommanderSafe);\n        loadCurrentCommander(newCommanderSafe, scene);\n    };\n\n    const prevCommander = () => {\n        const newCommander = currentCommander - 1;\n        const newCommanderSafe = newCommander < 0 ? Commanders.length - 1 : newCommander;\n        setCurrentCommander(newCommanderSafe);\n        loadCurrentCommander(newCommanderSafe, scene);\n    };\n\n    const onDone = () => {\n        props.onDone(currentCommander);\n    };\n\n    const afterLoadCommander = (scene, newMeshes, commanderIndex) => {\n        newMeshes[0].position = Commanders[commanderIndex].visuals.positionOffset ||\n            Vector3.Zero();\n        newMeshes[0].rotation = Commanders[commanderIndex].visuals.rotation ||\n            new Vector3(0, Math.PI, 0);\n        newMeshes[0].scalingDeterminant = 0.001 * Commanders[commanderIndex].scale;\n        newMeshes[0].isVisible = false;\n    }\n\n    const loadResources = (scene) => {\n        return new Promise((resolve, reject) => {\n            const loadedMeshes = [];\n\n            const assetsManager = new AssetsManager(scene);\n            _.each(Commanders, (commander, index) => {\n                const task = assetsManager.addMeshTask(index, '',\n                    Commanders[index].asset,\n                    'scene.gltf');\n                task.onSuccess = (task) => {\n                    loadedMeshes[index] = task.loadedMeshes;\n                    afterLoadCommander(scene, task.loadedMeshes, index);\n                };\n            });\n\n            assetsManager.onFinish = (tasks) => {\n                setLoadedMeshes(loadedMeshes);\n                resolve(loadedMeshes);\n            };\n\n            assetsManager.load();\n        });\n    };\n\n    const loadCurrentCommander = (currentCommander, scene, loadedMeshesOverride) => {\n        const meshes = loadedMeshesOverride || loadedMeshes;\n\n        _.each(scene.meshes, (mesh) => {\n            mesh.isVisible = false;\n        });\n\n        _.each(meshes[currentCommander], (mesh) => {\n            mesh.isVisible = true;\n        });\n\n        _.invoke(_.filter(scene.animationGroups, (group) => {\n            return _.contains(Commanders[currentCommander].visuals.pickAnimations, group.name);\n        }), 'play', true);\n    };\n\n    const onSceneMount = (e) => {\n        const { canvas, scene } = e;\n        setScene(scene);\n\n        scene.getEngine().loadingScreen = new OmegaLoadingScreen();\n\n        const camera = new ArcRotateCamera('camera1',\n            Math.PI / 2, Math.PI / 2, 9.0, Vector3.Zero(), scene);\n        camera.minZ = 0.001;\n        camera.upperAlphaLimit = Math.PI / 2;\n        camera.lowerAlphaLimit = Math.PI / 2;\n        camera.upperBetaLimit = Math.PI / 2;\n        camera.lowerBetaLimit = Math.PI / 2;\n        camera.lowerRadiusLimit = 9.0;\n        camera.upperRadiusLimit = 9.0;\n        scene.activeCameras.push(camera);\n        camera.attachControl(canvas, true);\n\n        const light = new HemisphericLight('light1', Vector3.Up(), scene);\n        light.intensity = 0.7;\n\n        const background = new Layer('background',\n            '/assets/images/jeremy-perkins-uhjiu8FjnsQ-unsplash.jpg', scene);\n        background.isBackground = true;\n        background.texture.level = 0;\n        background.texture.wAng = .2;\n\n        loadResources(scene).then((loadedMeshes) => {\n            setResourcesLoaded(true);\n            loadCurrentCommander(currentCommander, scene, loadedMeshes);\n        });\n    };\n\n    const commanderRarityColor = CommanderRaritiesColors[Commanders[currentCommander].rarity];\n    const commanderRarityString = commanderRarityToString(Commanders[currentCommander].rarity);\n\n    const commanderAttackSuffix = _.has(Commanders[currentCommander].stats.attack, 'vs')\n        ? ` vs ${Ships[Commanders[currentCommander].stats.attack.vs].name}`\n        : '';\n    const commanderAttackString = `+${Commanders[currentCommander].stats.attack.modifier}${commanderAttackSuffix}`;\n\n    const commanderDefenceSuffix = _.has(Commanders[currentCommander].stats.defence, 'vs')\n        ? ` vs ${Ships[Commanders[currentCommander].stats.defence.vs].name}`\n        : '';\n    const commanderDefenceString = `+${Commanders[currentCommander].stats.defence.modifier}${commanderDefenceSuffix}`;\n\n\n    return (\n        <div className=\"CommanderSelection\">\n            <Engine antialias={true} adaptToDeviceRatio={true} canvasId=\"ship-selection\">\n                <Scene onSceneMount={onSceneMount}/>\n            </Engine>\n            {resourcesLoaded &&\n                <div className=\"ui\">\n                    <div className=\"uiElement commanderName\" style={{color: commanderRarityColor}}>\n                        {Commanders[currentCommander].name}\n                    </div>\n                    <div className=\"uiElement sideBox commanderStats\">\n                        <div>\n                            Rarity: <span style={{color: commanderRarityColor}}>{commanderRarityString}</span>\n                        </div>\n                        <div>\n                            Level: 1\n                        </div>\n                        <div>\n                            Experience: 0/1000\n                        </div>\n                    </div>\n                    <div className=\"uiElement sideBox commanderControls\">\n                        <div>\n                            Attack:\n                            <div>{commanderAttackString}</div>\n                        </div>\n                        <div>\n                            Defence:\n                            <div>{commanderDefenceString}</div>\n                        </div>\n                    </div>\n                    <div className=\"uiElement commanderDescription\">\n                        {Commanders[currentCommander].description}\n                    </div>\n                    <div className=\"uiElement chevron left\" onClick={prevCommander}/>\n                    <div className=\"uiElement chevron right\" onClick={nextCommander}/>\n                    <div className=\"uiElement doneBox\" onClick={onDone}>\n                        DONE\n                    </div>\n                    <a className=\"miniLogoBox\" href=\"/\">\n                    </a>\n                    <div className=\"omegaTip\">\n                        <div className=\"title\">\n                            Commander Selection\n                        </div>\n                        <div className=\"explanation\">\n                            <div className=\"tip\">\n                                1. Each fleet in a fight is led by a Commander.\n                            </div>\n                            <div className=\"tip\">\n                                2. Commanders have different stats, skills, and rarity levels.\n                            </div>\n                            <div className=\"tip\">\n                                3. By winning in Ranked Combat, Commanders increase their experience and effectiveness.\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            }\n        </div>\n    );\n}\n","import React, { useState } from 'react';\nimport _ from 'underscore';\nimport { Engine, Scene } from 'react-babylonjs';\nimport { Vector3, Color3, Mesh, AssetsManager, StandardMaterial, ParticleHelper, Layer,\n    Animation, ArcRotateCamera, HemisphericLight } from '@babylonjs/core';\nimport '@babylonjs/loaders';\nimport { Ships } from '../definitions/Ships';\nimport { Commanders } from '../definitions/Commanders';\nimport { OmegaLoadingScreen } from '../common/OmegaLoadingScreen';\nimport './Combat.css';\n\nconst LASER_LENGTH_MS = 500;\nconst SHOOT_GAP_MS = 500;\n\n// props: selectionLhs, selectionRhs, commanderLhs, commanderRhs, result\nexport const Combat = (props) => {\n    const [ round, setRound ] = useState(0);\n    const [ showingResult, setShowingResult ] = useState(false);\n    const [ combatLog, setCombatLog ] = useState('');\n    const [ resourcesLoaded, setResourcesLoaded ] = useState(false);\n    let shipMeshesLhs = [];\n    let shipMeshesRhs = [];\n\n    const afterImportMeshes = (scene, newMeshes, currentShip,\n        basePosition, count, direction, isLhs) => {\n\n        newMeshes[0].position = new Vector3(basePosition + currentShip * direction, 0, -currentShip * 0.2);\n        newMeshes[0].rotation = new Vector3(Math.PI * 2, Math.PI / 2  * direction, Math.PI / 2 * -direction);\n        newMeshes[0].scalingDeterminant = 0.00013 * Ships[currentShip].scale;\n\n        _.each(newMeshes, (newMesh) => {\n            newMesh.material = new StandardMaterial(_.uniqueId(), scene);\n            newMesh.material.diffuseColor = isLhs\n                ? new Color3(0, 1, 0)\n                : new Color3(1, 1, 0)\n        });\n\n        if (isLhs) {\n            shipMeshesLhs[currentShip] = [ newMeshes[0] ];\n        } else {\n            shipMeshesRhs[currentShip] = [ newMeshes[0] ];\n        }\n\n        for (let i = 0; i < count - 1; i++) {\n            const clonedMesh = newMeshes[0].clone();\n\n            if (i % 2 === 0) {\n                clonedMesh.position.y -= (Math.floor(i / 2) + 1) * Ships[currentShip].combatScale;\n            } else {\n                clonedMesh.position.y += (Math.floor(i / 2) + 1) * Ships[currentShip].combatScale;\n            }\n\n            if (isLhs) {\n                shipMeshesLhs[currentShip].push(clonedMesh);\n            } else {\n                shipMeshesRhs[currentShip].push(clonedMesh);\n            }\n        }\n    };\n\n\n    const loadResources = (scene) => {\n        return new Promise((resolve, reject) => {\n            const assetsManager = new AssetsManager(scene);\n\n            _.each(props.selectionLhs, (count, index) => {\n                if (count > 0) {\n                    shipMeshesLhs[index] = [];\n                    const task = assetsManager.addMeshTask(index, '',\n                        Ships[index].asset,\n                        Ships[index].sceneFile || 'scene.gltf');\n                    task.onSuccess = (task) => {\n                        afterImportMeshes(scene, task.loadedMeshes, index, 10, count, 1, true);\n                    };\n                }\n            });\n\n            _.each(props.selectionRhs, (count, index) => {\n                if (count > 0) {\n                    shipMeshesRhs[index] = [];\n                    const task = assetsManager.addMeshTask(index, '',\n                        Ships[index].asset,\n                        'scene.gltf');\n                    task.onSuccess = (task) => {\n                        afterImportMeshes(scene, task.loadedMeshes, index, -10, count, -1, false);\n                    };\n                }\n            });\n\n            assetsManager.onFinish = (tasks) => {\n                resolve();\n            };\n\n            assetsManager.load();\n        });\n    };\n\n    const moveShips = (scene, move, isLhs) => {\n        const meshes = isLhs ? shipMeshesLhs[move.source] : shipMeshesRhs[move.source];\n\n        return Promise.all(_.map(meshes, (mesh) => {\n            return new Promise((resolve/*, reject*/) => {\n                const framerate = 10;\n                const slide = new Animation(_.uniqueId(), 'position.x', framerate,\n                    Animation.ANIMATIONTYPE_FLOAT, Animation.ANIMATIONLOOPMODE_CONSTANT);\n                const direction = isLhs ? -1 : 1;\n                const keyFrames = [\n                    {\n                        frame: 0,\n                        value: mesh.position.x,\n                    },\n                    {\n                        frame: framerate,\n                        value: mesh.position.x + Math.abs(move.targetPosition - mesh.position.x) * direction,\n                    },\n                    {\n                        frame: 2*framerate,\n                        value: move.targetPosition,\n                    }\n                ];\n                slide.setKeys(keyFrames);\n                mesh.animations = [ slide ];\n\n                scene.beginAnimation(mesh, 0, 2 * framerate, false, 2, resolve);\n            });\n        }));\n    };\n\n    const applyHpsToVisuals = (scene, target, isLhs, shipHpsLhs, shipHpsRhs) => {\n        const hpPerShip = Ships[target].stats.hp;\n        const hpsLeft = isLhs ? shipHpsRhs[target] : shipHpsLhs[target];\n        const shipsLeft = Math.max(Math.ceil(hpsLeft / hpPerShip), 0);\n        let meshes = isLhs ? shipMeshesRhs[target] : shipMeshesLhs[target];\n        const shipsToRemove = meshes.length - shipsLeft;\n\n        for (let removeIndex = 0; removeIndex < shipsToRemove; removeIndex++) {\n            const meshToRemove = meshes.shift();\n\n            // IMPROVEME only createasync once\n            ParticleHelper.CreateAsync('explosion', scene).then((set) => {\n                set.systems.forEach(s => {\n                    s.worldOffset = meshToRemove.position;\n                    s.disposeOnStop = true;\n                    s.maxSize = 0.01;\n                    s.minSize = 0.001;\n                });\n                set.systems = [ set.systems[0] ];\n                set.start();\n            });\n\n            meshToRemove.dispose();\n        }\n    };\n\n    let localLog = '';\n\n    const logAttack = (move, isLhs) => {\n        const prefix = isLhs ? '[Attacker]' : '[Defender]';\n        const newEntry = `${prefix} ${Ships[move.source].name} hits ${Ships[move.target].name} for ${move.damage} damage.`;\n        localLog = newEntry + '\\n' + localLog;\n        setCombatLog(localLog);\n    };\n\n    const logRoundStart = (round) => {\n        const newEntry = `Round ${round + 1} begins.\\n\\n`;\n        localLog = newEntry + localLog;\n        setCombatLog(localLog);\n    };\n\n    const showLaser = (scene, source, sourceMesh, targetMesh) => {\n        const mat = new StandardMaterial('laserMat', scene);\n        mat.alpha = 0.8;\n        mat.diffuseColor = Ships[source].visuals.beamColor;\n        mat.backFaceCulling = false;\n\n        const lines = Mesh.CreateTube('laser', [\n            sourceMesh.position,\n            targetMesh.position\n        ], Ships[source].visuals.beamWidth, 64, null, 0, scene, false, Mesh.FRONTSIDE);\n        lines.material = mat;\n        lines.convertToFlatShadedMesh();\n\n        setTimeout(() => {\n            lines.dispose();\n        }, LASER_LENGTH_MS);\n    };\n\n    const showAttacks = (scene, move, isLhs) => {\n        // for ships, each ship attacks next ship [0..n] meshes\n        const sourceMeshes = isLhs ? shipMeshesLhs : shipMeshesRhs;\n        const targetMeshes = isLhs ? shipMeshesRhs : shipMeshesLhs;\n        _.each(sourceMeshes[move.source], (sourceMesh, ind) => {\n            if (!targetMeshes[move.target] || !targetMeshes[move.target].length) {\n                return;\n            }\n\n            const targetMeshIndex = ind % targetMeshes[move.target].length;\n            const targetMesh = targetMeshes[move.target][targetMeshIndex];\n\n            showLaser(scene, move.source, sourceMesh, targetMesh);\n        });\n    };\n\n    const playMoves = (scene, moves, isLhs, shipHpsLhs, shipHpsRhs) => {\n        const _recursiveMover = (ind, mainResolver) => {\n            const move = moves[ind];\n\n            if (!move) {\n                return mainResolver();\n            }\n\n            let movePromise;\n            if (move.moveType === 'move') {\n                movePromise = moveShips(scene, move, isLhs);\n            } else {\n                movePromise = new Promise((resolve, reject) => {\n                    showAttacks(scene, move, isLhs);\n                    const shipHps = isLhs ? shipHpsRhs : shipHpsLhs;\n                    shipHps[move.target] -= move.damage;\n                    applyHpsToVisuals(scene, move.target, isLhs, shipHpsLhs,\n                        shipHpsRhs);\n                    logAttack(move, isLhs);\n\n                    setTimeout(resolve, SHOOT_GAP_MS);\n                });\n            }\n\n            movePromise.then(() => {\n                if (ind + 1 < moves.length) {\n                    _recursiveMover(ind + 1, mainResolver);\n                } else {\n                    mainResolver();\n                }\n            });\n        }\n\n        return new Promise((resolve, reject) => {\n            _recursiveMover(0, resolve);\n        });\n    };\n\n    const playRound = (scene, round, shipHpsLhs, shipHpsRhs) => { // recursive\n        if (round >= props.result.rounds) {\n            setShowingResult(true);\n            return;\n        }\n\n        setRound(round);\n        logRoundStart(round);\n\n        const lhsMoves = _.filter(props.result.lhs, (move) => {\n            return move.round === round && !_.isEmpty(move.moveType);\n        });\n        const rhsMoves = _.filter(props.result.rhs, (move) => {\n            return move.round === round && !_.isEmpty(move.moveType);\n        });\n\n        playMoves(scene, lhsMoves, true, shipHpsLhs, shipHpsRhs).then(() => {\n            playMoves(scene, rhsMoves, false, shipHpsLhs, shipHpsRhs).then(() => {\n                playRound(scene, round + 1, shipHpsLhs, shipHpsRhs);\n            });\n        })\n    };\n\n    const playCombat = (scene) => {\n        const shipHpsLhs = _.map(props.selectionLhs, (count, index) => {\n            return Ships[index].stats.hp * count;\n        });\n        const shipHpsRhs = _.map(props.selectionRhs, (count, index) => {\n            return Ships[index].stats.hp * count;\n        });\n\n        playRound(scene, 0, shipHpsLhs, shipHpsRhs);\n    };\n\n    const onSceneMount = (e) => {\n        const { canvas, scene } = e;\n\n        scene.getEngine().loadingScreen = new OmegaLoadingScreen();\n\n        const camera = new ArcRotateCamera('camera1',\n            Math.PI / 2, (Math.PI / 2) + Math.PI / 4, 18.5, Vector3.Zero(), scene);\n        camera.minZ = 0.001;\n        camera.lowerRadiusLimit = 18.5;\n        camera.upperRadiusLimit = 18.5;\n        scene.activeCameras.push(camera);\n        camera.attachControl(canvas, true);\n\n        const light = new HemisphericLight('light1', new Vector3(0, 0, 1), scene);\n        light.intensity = 0.7;\n\n        const background = new Layer('background',\n            '/assets/images/jeremy-perkins-uhjiu8FjnsQ-unsplash.jpg', scene);\n        background.isBackground = true;\n        background.texture.level = 0;\n        background.texture.wAng = .2;\n\n        loadResources(scene).then(() => {\n            setResourcesLoaded(true);\n            playCombat(scene);\n        })\n    };\n\n    const getWinnerString = () => {\n        const isDead = (shipHps) => {\n            return !_.find(shipHps, (shipHp) => shipHp > 0);\n        };\n\n        if (isDead(props.result.lhsHp)) {\n            return 'Defender Wins';\n        } else if (isDead(props.result.rhsHp)) {\n            return 'Attacker Wins';\n        } else {\n            return 'Draw';\n        }\n    }\n\n    const commanderAssetLhs = Commanders[props.commanderLhs].asset + 'thumb.png';\n    const commanderAssetRhs = Commanders[props.commanderRhs].asset + 'thumb.png';\n\n    return (\n        <div className=\"Combat\">\n            <Engine antialias={true} adaptToDeviceRatio={true} canvasId=\"combat\">\n                <Scene onSceneMount={onSceneMount}/>\n            </Engine>\n            {resourcesLoaded &&\n                <div className=\"ui\">\n                    <div className=\"uiElement commander lhs\">\n                        <img alt=\"Commander\" src={commanderAssetLhs}>\n                        </img>\n                    </div>\n                    <div className=\"uiElement commander rhs\">\n                        <img alt=\"Commander\" src={commanderAssetRhs}>\n                        </img>\n                    </div>\n                    <div className=\"uiElement currentRound\">\n                        Round {round+1}\n                    </div>\n                    <div className=\"uiElement combatLog\">\n                        <pre>{combatLog}</pre>\n                    </div>\n                    <div className=\"uiElement doneBox\" onClick={() => { setShowingResult(true) }}>\n                        FINISH\n                    </div>\n                    <div className=\"miniLogoBox\"></div>\n                    {showingResult &&\n                        <div className=\"result\">\n                            <div className=\"resultDialog\">\n                                <div className=\"winner\">\n                                    {getWinnerString()}\n                                </div>\n                                <a className=\"exitButton\" href=\"/\">\n                                    EXIT\n                                </a>\n                            </div>\n                        </div>\n                    }\n                </div>\n            }\n        </div>\n    );\n}\n","import './OpponentSelection.css';\nimport React from 'react';\nimport _ from 'underscore';\n\n\n// props.opponents, props.onDone\nexport const OpponentSelection = (props) => {\n    const selectOpponent = (opponent) => {\n        props.onDone(opponent);\n    };\n\n    const renderOpponent = (opponent, ind) => {\n        return (\n            <div\n                key={ind}\n                className=\"mainMenuItem\"\n                onClick={() => { selectOpponent(opponent) }}\n            >\n                {opponent.name}\n            </div>\n        );\n    };\n\n    return (\n        <div className=\"OpponentSelection\">\n            <div className=\"ui\">\n                <div className=\"mainTitle\">\n                </div>\n                <div className=\"mainMenu\">\n                    {_.map(props.opponents, renderOpponent)}\n                </div>\n                <div className=\"versionBox uiElement\">\n                    Version: 0.0.1 (c) celrisen.eth\n                </div>\n                <div className=\"ethBalance uiElement\">\n\n                </div>\n                <a className=\"miniLogoBox\" href=\"/\">\n                </a>\n            </div>\n        </div>\n    );\n};\n","import './Leaderboard.css';\nimport React from 'react';\nimport _ from 'underscore';\n\n\n// props.opponents, props.onDone\nexport const Leaderboard = (props) => {\n    const renderEntry = (entry, ind) => {\n        return (\n            <div\n                key={ind}\n                className=\"mainMenuItem\"\n            >\n                <div className=\"name\">{entry.name}</div>\n                <div className=\"address\">Address: {entry.player}</div>\n                <div className=\"wins\">Wins: {entry.wins.toNumber()}</div>\n                <div className=\"losses\">Losses: {entry.losses.toNumber()}</div>\n            </div>\n        );\n    };\n\n    return (\n        <div className=\"Leaderboard\">\n            <div className=\"ui\">\n                <div className=\"mainTitle\">\n                </div>\n                <div className=\"mainMenu\">\n                    {_.map(props.leaderboard, renderEntry)}\n                </div>\n                <div className=\"versionBox uiElement\">\n                    Version: 0.0.1 (c) celrisen.eth\n                </div>\n                <div className=\"ethBalance uiElement\">\n\n                </div>\n                <a className=\"miniLogoBox\" href=\"/\">\n                </a>\n            </div>\n        </div>\n    );\n};\n","import './ShowLogs.css';\nimport React from 'react';\nimport _ from 'underscore';\n\n\n// props.opponents, props.onDone\nexport const ShowLogs = (props) => {\n    const selectLog = (log) => {\n        props.onDone(log);\n    };\n\n    const renderLog = (log, ind) => {\n        return (\n            <div\n                key={ind}\n                className=\"mainMenuItem\"\n                onClick={() => { selectLog(log) }}\n            >\n                <span className=\"address\">{log.args[0]}</span>\n                <span className=\"vs\"> vs </span>\n                <span className=\"address\">{log.args[1]}</span>\n            </div>\n        );\n    };\n\n    return (\n        <div className=\"ShowLogs\">\n            <div className=\"ui\">\n                <div className=\"mainTitle\">\n                </div>\n                <div className=\"mainMenu\">\n                    {_.map(props.logs, renderLog)}\n                </div>\n                <div className=\"versionBox uiElement\">\n                    Version: 0.0.1 (c) celrisen.eth\n                </div>\n                <div className=\"ethBalance uiElement\">\n\n                </div>\n                <a className=\"miniLogoBox\" href=\"/\">\n                </a>\n            </div>\n        </div>\n    );\n};\n","import _ from 'underscore';\nimport { Ships } from './Ships';\n\n\nexport const GameEngine = (selectionLhs, selectionRhs) => {\n    const MAX_ROUNDS = 50;\n    const BOARD_SIZE = 15;\n\n    const shipPositionsLhs = [ 10, 11, 12, 13 ];\n    const shipPositionsRhs = [ -10, -11, -12, -13 ];\n\n    const shipMaxHpLhs = _.map(selectionLhs, (count, index) => {\n        return (Ships[index].stats.hp * count) || 0;\n    });\n    const shipMaxHpRhs = _.map(selectionRhs, (count, index) => {\n        return (Ships[index].stats.hp * count) || 0;\n    });\n    let shipHpsLhs = _.clone(shipMaxHpLhs);\n    let shipHpsRhs = _.clone(shipMaxHpRhs);\n\n    const isLhsDead = () => {\n        return !_.find(shipHpsLhs, (shipHp) => shipHp > 0);\n    };\n    const isRhsDead = () => {\n        return !_.find(shipHpsRhs, (shipHp) => shipHp > 0);\n    };\n\n    const getTarget = (currentShip, shipPositionsOwn, shipPositionsEnemy, shipHpsEnemy) => {\n        const position = shipPositionsOwn[currentShip];\n        const distances = _.map(shipPositionsEnemy, (positionTarget, enemyShip) => {\n            const distance = Math.abs(position - positionTarget);\n\n            if (shipHpsEnemy[enemyShip] <= 0) {\n                return Number.MAX_SAFE_INTEGER;\n            }\n            if (distance > Ships[currentShip].stats.range) {\n                return Number.MAX_SAFE_INTEGER;\n            }\n            return distance;\n        });\n        const min = _.min(distances);\n        const index = distances.indexOf(min);\n\n        return min === Number.MAX_SAFE_INTEGER ? null : index;\n    };\n\n    const getTargetLhs = (currentShip) => {\n        return getTarget(currentShip, shipPositionsLhs, shipPositionsRhs, shipHpsRhs);\n    };\n\n    const getTargetRhs = (currentShip) => {\n        return getTarget(currentShip, shipPositionsRhs, shipPositionsLhs, shipHpsLhs);\n    };\n\n    const getRandomInt = (max) => {\n        return Math.floor(Math.random() * Math.floor(max));\n    };\n\n    const calculateDamage = (source, target, sourceHp, sourceMaxHp) => {\n        const attack = Ships[source].stats.attack.base +\n            getRandomInt(Ships[source].stats.attack.variable);\n        const defence = Ships[target].stats.defence;\n        const accuracy = 100 - Ships[target].stats.agility;\n        const damage = (attack - defence) * accuracy * (sourceHp / sourceMaxHp);\n\n        const sourceShipsCount = Math.ceil(sourceHp / Ships[source].stats.hp);\n        const capDamage = sourceShipsCount * Ships[target].stats.hp;\n\n        return Math.min(Math.floor(Math.max(0, damage)), capDamage);\n    };\n\n    const isPositionFree = (position) => {\n        if (Math.abs(position) > BOARD_SIZE) {\n            return false;\n        }\n\n        return !_.find(shipPositionsLhs, (positionIter, ind) => {\n            return positionIter === position && shipHpsLhs[ind] > 0;\n        }) && !_.find(shipPositionsRhs, (positionIter, ind) => {\n            return positionIter === position && shipHpsRhs[ind] > 0;\n        });\n    };\n\n    const moveShips = (shipPositions, source, direction) => {\n        const speed = Ships[source].stats.speed;\n\n        for (let speedCheck = speed; speedCheck > 0; speedCheck--) {\n            const proposedPosition = shipPositions[source] + direction * speedCheck;\n            if (isPositionFree(proposedPosition)) {\n                shipPositions[source] = proposedPosition;\n                break;\n            }\n        }\n\n        return shipPositions[source];\n    };\n\n    const moveShipLhs = (source) => {\n        return moveShips(shipPositionsLhs, source, -1);\n    };\n\n    const moveShipRhs = (source) => {\n        return moveShips(shipPositionsRhs, source, 1);\n    };\n\n    const lhsMoves = [], rhsMoves = [];\n    const logShoot = (round, moves, source, target, damage) => {\n        moves.push({\n            moveType: 'shoot',\n            round,\n            source,\n            target,\n            damage,\n        });\n    };\n\n    const logMove = (round, moves, source, targetPosition) => {\n        moves.push({\n            moveType: 'move',\n            round,\n            source,\n            targetPosition,\n        });\n    };\n\n    const logLhsShoot = (round, source, target, damage) => {\n        logShoot(round, lhsMoves, source, target, damage);\n    };\n\n    const logLhsMove = (round, source, targetPosition) => {\n        logMove(round, lhsMoves, source, targetPosition);\n    };\n\n    const logRhsShoot = (round, source, target, damage) => {\n        logShoot(round, rhsMoves, source, target, damage);\n    };\n\n    const logRhsMove = (round, source, targetPosition) => {\n        logMove(round, rhsMoves, source, targetPosition);\n    };\n\n    let round;\n    for (round = 0; round < MAX_ROUNDS && !isLhsDead() && !isRhsDead(); round++) {\n        // Left turn\n        for (let currentShip = 0; currentShip < Ships.length; currentShip++) {\n            if (shipHpsLhs[currentShip] > 0) {\n                const target = getTargetLhs(currentShip);\n                if (target || target === 0) { // Shoot\n                    const damage = calculateDamage(currentShip, target,\n                        shipHpsLhs[currentShip], shipMaxHpLhs[currentShip]);\n                    shipHpsRhs[target] -= damage;\n                    logLhsShoot(round, currentShip, target, damage);\n                } else { // Move\n                    moveShipLhs(currentShip);\n                    logLhsMove(round, currentShip, shipPositionsLhs[currentShip]);\n                }\n            }\n        }\n\n        // Right turn\n        for (let currentShip = 0; currentShip < Ships.length; currentShip++) {\n            if (shipHpsRhs[currentShip] > 0) {\n                const target = getTargetRhs(currentShip);\n                if (target || target === 0) { // Shoot\n                    const damage = calculateDamage(currentShip, target,\n                        shipHpsRhs[currentShip], shipMaxHpRhs[currentShip]);\n                    shipHpsLhs[target] -= damage;\n                    logRhsShoot(round, currentShip, target, damage);\n                } else { // Move\n                    moveShipRhs(currentShip);\n                    logRhsMove(round, currentShip, shipPositionsRhs[currentShip]);\n                }\n            }\n        }\n    }\n\n    return {\n        lhs: lhsMoves,\n        rhs: rhsMoves,\n        lhsHp: shipHpsLhs,\n        rhsHp: shipHpsRhs,\n        rounds: round,\n    };\n};\n","import './App.css';\nimport React, { Component } from 'react';\nimport { ethers } from 'ethers';\nimport * as TrinitySDK from \"@elastosfoundation/trinity-dapp-sdk\";\nimport { ShipSelection } from './scenes/ShipSelection';\nimport { CommanderSelection } from './scenes/CommanderSelection';\nimport { Combat } from './scenes/Combat';\nimport { OpponentSelection } from './ui/OpponentSelection';\nimport { Leaderboard } from './ui/Leaderboard';\nimport { ShowLogs } from './ui/ShowLogs';\nimport { GameEngine } from './definitions/GameEngine';\nimport { Ships } from './definitions/Ships';\nimport _ from 'underscore';\n\n\nconst Modes = {\n    MainScreen: 0,\n    ShipSelection: 1,\n    CommanderSelection: 2,\n    CommanderPreview: 3,\n    Combat: 4,\n    OpponentSelection: 5,\n    ShowLogs: 6,\n    Leaderboard: 7,\n};\n\nexport default class OmegaApp extends Component {\n    constructor(props) {\n        super(props);\n\n        this.defaultLoadedState = {\n            mode: Modes.MainScreen,\n            loading: false,\n            trainingSelfSelection: null,\n            trainingResult: null,\n            trainingSelfCommander: null,\n            trainingOpponent: null,\n            trainingOpponentSelection: null,\n            trainingOpponentCommander: null,\n            trainingCp: null,\n            defenders: null,\n            settingDefence: false,\n            settingAttack: false,\n        };\n\n        this.defaultUnloadedState = {\n            ownAccount: null,\n            web3Loaded: false,\n            gameEngineContract: null,\n            gameManagerContract: null,\n        };\n\n        this.state = {\n            ...this.defaultLoadedState,\n            ...this.defaultUnloadedState,\n        };\n    }\n\n    shipSelectionDone(selection) {\n        const trainingResult = !this.state.settingDefence &&\n            GameEngine(selection, this.state.trainingOpponentSelection);\n\n        this.setState({\n            mode: Modes.CommanderSelection,\n            trainingSelfSelection: selection,\n            trainingResult,\n        });\n    }\n\n    async commanderSelectionDone(commander) {\n        if (this.state.settingDefence) {\n            this.setState({\n                loading: true,\n            });\n\n            await this.state.gameManagerContract.registerDefence(\n                this.state.trainingSelfSelection,\n                commander,\n                this.state.ownAccount\n            );\n\n            this.setState(this.defaultLoadedState);\n        } else if (this.state.settingAttack) {\n            this.setState({\n                loading: true,\n            });\n\n            await this.state.gameManagerContract.attack(\n                this.state.trainingOpponent,\n                this.state.trainingSelfSelection,\n                commander\n            );\n\n            this.setState(this.defaultLoadedState);\n        } else {\n            this.setState({\n                mode: Modes.Combat,\n                trainingSelfCommander: commander,\n            });\n        }\n    }\n\n    commanderPreviewDone() {\n        this.setState(this.defaultLoadedState);\n    }\n\n    opponentSelectionDone(opponent) {\n        const trainingOpponentSelection = opponent.defenceSelection;\n\n        this.setState({\n            mode: Modes.ShipSelection,\n            settingAttack: true,\n            trainingOpponent: opponent.player,\n            trainingOpponentSelection,\n            trainingOpponentCommander: opponent.commander,\n            trainingCp: this._selectionToCp(trainingOpponentSelection),\n        });\n    }\n\n    _selectionToCp(selection) {\n        return _.reduce(selection, (memo, num, index) => {\n            return memo + (num || 0) * Ships[index].stats.cp;\n        }, 0);\n    }\n\n    training() {\n        const trainingOpponentSelection = [25, 18, 16, 6];\n\n        this.setState({\n            mode: Modes.ShipSelection,\n            trainingOpponentSelection,\n            trainingCp: this._selectionToCp(trainingOpponentSelection),\n        });\n    }\n\n    commanders() {\n        this.setState({\n            mode: Modes.CommanderPreview,\n        });\n    }\n\n    defend() {\n        const trainingOpponentSelection = [25, 18, 16, 6];\n\n        this.setState({\n            mode: Modes.ShipSelection,\n            settingDefence: true,\n            trainingOpponentSelection,\n            trainingCp: this._selectionToCp(trainingOpponentSelection),\n        });\n    }\n\n    async showLogs() {\n        const filter = this.state.gameManagerContract.filters.FightComplete();\n        filter.fromBlock = this.state.provider.getBlockNumber().then((b) => b - 10000);\n        filter.toBlock = 'latest';\n        filter.attacker = this.state.ownAccount;\n\n        this.setState({\n            loading: true,\n        });\n\n        const logs = await this.state.provider.getLogs(filter);\n        const logsParsed = _.map(logs, (log) => {\n            return this.state.gameManagerContract.interface.parseLog(log);\n        });\n\n        this.setState({\n            mode: Modes.ShowLogs,\n            logs: logsParsed,\n            loading: false,\n        });\n    }\n\n    logSelectionDone(log) {\n        const result = log.args[2];\n\n        const _parseMoves = (moves) => {\n            return _.map(moves, (move) => {\n                return {\n                    ...move,\n                    damage: move.damage.toNumber(),\n                };\n            });\n        };\n\n        const _parseHp = (hp) => {\n            return _.map(hp, (hpInst) => {\n                return hpInst.toNumber();\n            });\n        }\n\n        const resultJson = {\n            lhs: _parseMoves(result.lhs),\n            rhs: _parseMoves(result.rhs),\n            lhsHp: _parseHp(result.lhsHp),\n            rhsHp: _parseHp(result.rhsHp),\n            rounds: result.rounds,\n            selectionLhs: result.selectionLhs,\n            selectionRhs: result.selectionRhs,\n            commanderLhs: result.commanderLhs,\n            commanderRhs: result.commanderRhs,\n        };\n\n        this.setState({\n            mode: Modes.Combat,\n            trainingSelfSelection: resultJson.selectionLhs,\n            trainingSelfCommander: resultJson.commanderLhs,\n            trainingOpponentSelection: resultJson.selectionRhs,\n            trainingResult: resultJson,\n        });\n    }\n\n    async attack() {\n        this.setState({\n            loading: true,\n        });\n\n        const defenders = await this.state.gameManagerContract.getAllDefenders();\n\n        this.setState({\n            mode: Modes.OpponentSelection,\n            defenders,\n            loading: false,\n        });\n    }\n\n    async leaderboard() {\n        this.setState({\n            loading: true,\n        });\n\n        const leaderboard = await this.state.gameManagerContract.getLeaderboard();\n\n        this.setState({\n            mode: Modes.Leaderboard,\n            leaderboard,\n            loading: false,\n        });\n    }\n\n    render() {\n        return (\n            <div className=\"App\">\n                {this.state.mode === Modes.MainScreen &&\n                    <div className=\"mainScreen ui\">\n                        <div className=\"mainTitle\">\n                        </div>\n                        <div className=\"mainMenu\">\n                            <div className=\"mainMenuItem\" onClick={this.training.bind(this)}>\n                                TRAINING\n                            </div>\n                            <div className=\"mainMenuItem\" onClick={this.commanders.bind(this)}>\n                                COMMANDERS\n                            </div>\n                            <div className=\"mainMenuItem\" onClick={this.showLogs.bind(this)}>\n                                LOGS\n                            </div>\n                            <div className=\"mainMenuItem\" onClick={this.defend.bind(this)}>\n                                DEFENCE\n                            </div>\n                            <div className=\"mainMenuItem\" onClick={this.attack.bind(this)}>\n                                ATTACK\n                            </div>\n                            <div className=\"mainMenuItem\" onClick={this.leaderboard.bind(this)}>\n                                LEADERBOARD\n                            </div>\n                        </div>\n                        <div className=\"versionBox uiElement\">\n                            Version: 0.0.1 (c) celrisen.eth\n                        </div>\n                    </div>\n                }\n                {this.state.mode === Modes.ShipSelection &&\n                    <ShipSelection maxCp={this.state.trainingCp} onDone={this.shipSelectionDone.bind(this)}/>\n                }\n                {this.state.mode === Modes.CommanderSelection &&\n                    <CommanderSelection onDone={this.commanderSelectionDone.bind(this)}/>\n                }\n                {this.state.mode === Modes.CommanderPreview &&\n                    <CommanderSelection onDone={this.commanderPreviewDone.bind(this)}/>\n                }\n                {this.state.mode === Modes.Combat &&\n                    <Combat selectionLhs={this.state.trainingSelfSelection}\n                        selectionRhs={this.state.trainingOpponentSelection}\n                        commanderLhs={this.state.trainingSelfCommander}\n                        commanderRhs={0}\n                        result={this.state.trainingResult}\n                    />\n                }\n                {this.state.mode === Modes.OpponentSelection &&\n                    <OpponentSelection opponents={this.state.defenders}\n                        onDone={this.opponentSelectionDone.bind(this)}\n                    />\n                }\n                {this.state.mode === Modes.ShowLogs &&\n                    <ShowLogs logs={this.state.logs} onDone={this.logSelectionDone.bind(this)}/>\n                }\n                {this.state.mode === Modes.Leaderboard &&\n                    <Leaderboard leaderboard={this.state.leaderboard}/>\n                }\n                <div\n                    id=\"omegaLoadingScreen\"\n                    style={this.state.web3Loaded && !this.state.loading ? {display: 'none'} : {}}>\n                    <div className=\"logo\"/>\n                    <div className=\"progressOuter progress-line\"/>\n                </div>\n            </div>\n        );\n    }\n\n    componentDidMount() {\n        this._initWeb3();\n    }\n\n    async _initWeb3() {\n        // const provider = new TrinitySDK.Ethereum.Web3.Providers.TrinityWeb3Provider();\n        const provider = new ethers.providers.Web3Provider(window.ethereum);\n        const signer = provider.getSigner();\n\n        // const provider = new Web3(window.ethereum);\n        const accounts = await window.ethereum.send('eth_requestAccounts');\n\n        this.setState({\n            provider,\n            ownAccount: accounts.result[0],\n            signer,\n        }, () => {\n            this._loadContracts(signer);\n        });\n    }\n\n    _loadContracts(signer) {\n        const gameEngineJson = require('./abi/GameEngine.json');\n        const gameEngineContractAddress = '0x39a3c0cDddF3f46A1b7462e911508E20230e6034';\n        const gameEngineContract = new ethers.Contract(gameEngineContractAddress, gameEngineJson, signer);\n\n        const gameManagerJson = require('./abi/GameManager.json');\n        const gameManagerContractAddress = '0xc7ed5147cd9C348fdd3Fa954c3391597873ec010';\n        const gameManagerContract = new ethers.Contract(gameManagerContractAddress, gameManagerJson, signer);\n\n        this.setState({\n            gameEngineContract,\n            gameManagerContract,\n            web3Loaded: true,\n        });\n    }\n}\n\n","import * as Sentry from \"@sentry/react\";\nimport { Integrations } from \"@sentry/tracing\";\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport OmegaApp from './OmegaApp';\n\nSentry.init({\n  dsn: \"https://adf39eeb31a04f4c9e2ae1613a647396@o509705.ingest.sentry.io/5604612\",\n  debug: true,\n  autoSessionTracking: true,\n\n  // We recommend adjusting this value in production, or using tracesSampler\n  // for finer control\n  tracesSampleRate: 1.0,\n});\n\nReactDOM.render(<OmegaApp />, document.getElementById('root'));\n"],"sourceRoot":""}